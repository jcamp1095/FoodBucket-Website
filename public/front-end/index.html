<!DOCTYPE html>
<html ng-app>
    <head>
        <meta charset="UTF-8">
        <title>Awesome Bootstrap 3 Sidebar Navigation</title>

        <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
        <link rel="stylesheet" href="css/test.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
        <script src="js/fb.js"></script>
        
    </head>

    <body>
        <nav class="navbar navbar-default no-margin" ng-controller="MyBucketController">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header fixed-brand">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"  id="menu-toggle">
                    <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span>
                </button>
                <a class="navbar-brand" href="#"><i class="fa fa-map fa-4"></i> Food Bucketlist</a>
            </div><!-- navbar-header-->

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <form class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                        <input type="search" class="form-control" id="search_input" placeholder="Search by location...">
                    </div>
                    <button type="button" id="addfriends" onclick='find_friends()'class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal">Add Friends</button>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <fb:login-button data-auto-logout-link="true" ng-click="reset()" scope="public_profile,email" class="center" onlogin="checkLoginState();"></fb:login-button>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#" id="status"></a></li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>

        <!-- Import Google Maps -->
        <script src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>

        <!-- Sidebar / Map Container -->
        <div id="container">
            <!-- Google Map -->
            <div id="map">MAP</div>
            
            <!-- SideBar -->
            <div id="sidebar-wrapper">
                <ul class="sidebar-nav nav-pills nav-stacked" id="menu">
                    <li ng-controller="MyBucketController">
                        <a href="#" onclick='add_to_map()'><span class="fa-stack fa-lg pull-left"><i class="fa fa-user fa-stack-1x "></i></span> My Bucketlist</a>
                        <ul ng-repeat="restaurant in restaurants" class="nav-pills nav-stacked" style="list-style-type:none;">
                            <li><a href="#" ng-click="put_on_map(restaurant.name)"><span class="fa-stack fa-lg pull-left"><i class="fa fa-map-pin fa-stack-1x "></i></span>{{restaurant.name}}</a></li>
                           
                        </ul>
                    </li>
                    <li ng-controller="GroupController">
                        <a href="#"><span class="fa-stack fa-lg pull-left"><i class="fa fa-users fa-stack-1x "></i></span> Group Bucketlists</a>
                        <ul ng-repeat="friend in friends" class="nav-pills nav-stacked" style="list-style-type:none;">
                            <li><a href="#" ng-click="put_friend_map(friend.name)"><span class="fa-stack fa-lg pull-left"><i class="fa fa-map-pin fa-stack-1x "></i></span>{{friend.name}}</a></li>
                           
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick='add_recommendations()'><span class="fa-stack fa-lg pull-left"><i class="fa fa-search-plus fa-stack-1x "></i></span>Recommendations</a>
                     </li>
                </ul>
            </div><!-- /#sidebar-wrapper -->
        </div>
    </div>

    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Add friends to your group bucket list!</h4>
          </div>
          <div class="modal-body">
            <div id="placeholder" ></div>
            <script>
            function find_friends(){
                    all_people = [];
                    FB.api('/me', function(response) { 
                        id = response.id;
                        user_name = response.name;
                        var url = "https://food-bucket.herokuapp.com/people?userId=" + id + "&username=" + user_name;
                        var data_request = new XMLHttpRequest();

                        data_request.open("GET", url, true);

                        data_request.onreadystatechange = function () {
                                if (data_request.readyState == 4 && data_request.status == 200) {
                                        raw = data_request.responseText;
                                        data = JSON.parse(raw);
                                        for (i = 0; i < data.length; i++) {
                                                name = data[i]['username'];
                                                id = data[i]['userId'];
                                                name_data = {user_name:name, user_id:id};
                                                all_people.push(name_data);
                                        }
                                        
                                        output_string = "";
                                        for (i = 0; i < all_people.length; i++) {
                                                output_string+="<li><a href='#' onclick='sendfriend(\"" + id +"\", \"" + all_people[i].user_id +"\", \"" + all_people[i].user_name +"\")' </a>" + all_people[i].user_name + "</li>";
                                        }

                                        document.getElementById("placeholder").innerHTML=output_string;
                                };   
                        };

                        data_request.send(null);
                    });     
            }; 

            function sendfriend(myid, friend_id, friend_name) {
                    friend_data = { "userId"     : myid, 
                          "friend_userId"  : friend_id,
                          "friend_name" : friend_name
                    };

                    $.ajax({
                     type: "POST",
                     url: "https://food-bucket.herokuapp.com/sendFriend",
                     data: friend_data,
                     success: alert("sent friend"),
                     dataType: 'json'
                    });
            }
            </script>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>

      </div>
    </div>


    <!-- Javascript imports -->
    <script src="js/maps.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>

    </body>
</html>
